<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>HALFON | Siege Engineers</title>
    <link rel="stylesheet" href="css/bulma.min.css">
    <style type="text/css">
        .table.units-buildings-table tbody tr td,
        .table.units-buildings-table thead tr th,
        .table.units-buildings-table tfoot tr th,
        .table.techs-table tbody tr td,
        .table.techs-table thead tr th,
        .table.techs-table tfoot tr th {
            text-align: right;
        }

        .table.units-buildings-table tbody tr td:nth-child(2),
        .table.units-buildings-table tbody tr td:nth-child(3),
        .table.units-buildings-table tbody tr td:nth-child(14),
        .table.units-buildings-table tbody tr td:nth-child(15),
        .table.units-buildings-table thead tr th:nth-child(2),
        .table.units-buildings-table thead tr th:nth-child(3),
        .table.units-buildings-table thead tr th:nth-child(14),
        .table.units-buildings-table thead tr th:nth-child(15),
        .table.units-buildings-table tfoot tr th:nth-child(2),
        .table.units-buildings-table tfoot tr th:nth-child(3),
        .table.units-buildings-table tfoot tr th:nth-child(14),
        .table.units-buildings-table tfoot tr th:nth-child(15),
        .table.techs-table tbody tr td:nth-child(2),
        .table.techs-table tbody tr td:nth-child(3),
        .table.techs-table thead tr th:nth-child(2),
        .table.techs-table thead tr th:nth-child(3),
        .table.techs-table tfoot tr th:nth-child(2),
        .table.techs-table tfoot tr th:nth-child(3) {
            text-align: left;
        }

        .gc {
            color: #888;
        }

        .gc.active {
            color: black;
        }

        .wood,
        .food,
        .gold,
        .stone {
            color: #ccc;
        }

        .wood.active {
            color: #830;
        }

        .food.active {
            color: #d00;
        }

        .gold.active {
            color: #da0;
        }

        .stone.active {
            color: #444;
        }

        .tag.is-copyable {
            cursor: pointer;
        }
    </style>
</head>
<body>
<section class="hero is-warning is-bold">
    <div class="hero-body">
        <div class="container">
            <h1 class="title is-2">
                <img src="img/SiegeEngineers.png" alt="Siege Engineers"/> HALFON
            </h1>
            <p class="subtitle">
                Age of Empires II unit, building and tech reference.
            </p>
        </div>
    </div>
</section>
<section class="section">
    <div class="container content">
        <div class="columns">
            <div class="column is-one-thirds">
                <input class="input is-rounded" type="text" id="filter" placeholder="Filter...">
            </div>
            <div class="column is-two-thirds has-text-right	">
                <div class="tabs is-toggle is-toggle-rounded is-inline-block">
                    <ul class="is-marginless">
                        <li id="loadDE" class="is-active">
                            <a><span>AoEII DE Update 147949</span></a>
                        </li>
                        <li id="loadROR">
                            <a><span>AoEII ROR Update 111772</span></a>
                        </li>
                        <li id="loadHD">
                            <a><span>AoEII HD Patch 5.8</span></a>
                        </li>
                        <li id="loadWK">
                            <a><span>AoEII WK Patch 5.8.1</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="tabs is-medium">
            <ul>
                <li class="is-active" id="units-buildings"><a>Units / Buildings</a></li>
                <li id="technologies"><a>Technologies</a></li>
            </ul>
        </div>
        <table class="table is-narrow is-hoverable is-fullwidth units-buildings-table is-small"
               id="units-buildings-table">
            <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col" width="15%">Name</th>
                <th scope="col"><abbr title="often inaccurate for non-conventional units">Localised Name</abbr></th>
                <th scope="col"><abbr title="Hitpoints">HP</abbr></th>
                <th scope="col"><abbr title="Line of Sight">LOS</abbr></th>
                <th scope="col"><abbr title="Attack">ATK</abbr></th>
                <th scope="col"><abbr title="Melee Armor">MA</abbr></th>
                <th scope="col"><abbr title="Pierce Armor">PA</abbr></th>
                <th scope="col"><abbr title="Garrison Capacity">GC</abbr></th>
                <th scope="col"><abbr title="Wood Cost">Wood</abbr></th>
                <th scope="col"><abbr title="Food Cost">Food</abbr></th>
                <th scope="col"><abbr title="Gold Cost">Gold</abbr></th>
                <th scope="col"><abbr title="Stone Cost">Stone</abbr></th>
                <th scope="col" width="12%">Type</th>
                <th scope="col" width="15%">Class</th>
            </tr>
            </thead>
            <tbody id="units_buildings" class="filterable">
            <tr><td colspan="15" class="has-text-left is-loading">Loading ...</td></tr>
            </tbody>
            <tfoot>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col"><abbr title="often inaccurate for non-conventional units">Localised Name</abbr></th>
                <th scope="col"><abbr title="Hitpoints">HP</abbr></th>
                <th scope="col"><abbr title="Line of Sight">LOS</abbr></th>
                <th scope="col"><abbr title="Attack">ATK</abbr></th>
                <th scope="col"><abbr title="Melee Armor">MA</abbr></th>
                <th scope="col"><abbr title="Pierce Armor">PA</abbr></th>
                <th scope="col"><abbr title="Garrison Capacity">GC</abbr></th>
                <th scope="col"><abbr title="Wood Cost">Wood</abbr></th>
                <th scope="col"><abbr title="Food Cost">Food</abbr></th>
                <th scope="col"><abbr title="Gold Cost">Gold</abbr></th>
                <th scope="col"><abbr title="Stone Cost">Stone</abbr></th>
                <th scope="col">Type</th>
                <th scope="col">Class</th>
            </tr>
            </tfoot>
        </table>
        <table class="table is-narrow is-hoverable techs-table is-hidden" id="technologies-table">
            <thead>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Localised Name</th>
                <th scope="col"><abbr title="Wood Cost">Wood</abbr></th>
                <th scope="col"><abbr title="Food Cost">Food</abbr></th>
                <th scope="col"><abbr title="Gold Cost">Gold</abbr></th>
                <th scope="col"><abbr title="Stone Cost">Stone</abbr></th>
            </tr>
            </thead>
            <tbody id="techs" class="filterable">
            <tr><td colspan="7">Loading ...</td></tr>
            </tbody>
            <tfoot>
            <tr>
                <th scope="col">ID</th>
                <th scope="col">Name</th>
                <th scope="col">Localised Name</th>
                <th scope="col"><abbr title="Wood Cost">Wood</abbr></th>
                <th scope="col"><abbr title="Food Cost">Food</abbr></th>
                <th scope="col"><abbr title="Gold Cost">Gold</abbr></th>
                <th scope="col"><abbr title="Stone Cost">Stone</abbr></th>
            </tr>
            </tfoot>
        </table>
    </div>
</section>
<script type="text/javascript">
    const applyFilter = () => {
        const input = document.getElementById('filter');
        const filter = input.value.replace(/ /g, '_').toLowerCase();
        const tables = document.getElementsByClassName('filterable');
        for (let table of tables) {
            const tr = table.getElementsByTagName('tr');

            for (let i = 0; i < tr.length; i++) {
                if (tr[i] !== undefined) {
                    if (tr[i].id.toLowerCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    };

    const classes = ["Archer",
        "Artifact",
        "Trade Boat",
        "Building",
        "Civilian",
        "Ocean Fish",
        "Infantry",
        "Berry Bush",
        "Stone Mine",
        "Prey Animal",
        "Predator Animal",
        "Miscellaneous",
        "Cavalry",
        "Siege Weapon",
        "Terrain",
        "Tree",
        "Tree Stump",
        "Healer",
        "Monk",
        "Trade Cart",
        "Transport Boat",
        "Fishing Boat",
        "Warship",
        "Conquistador",
        "War Elephant",
        "Hero",
        "Elephant Archer",
        "Wall",
        "Phalanx",
        "Domestic Animal",
        "Flag",
        "Deep Sea Fish",
        "Gold Mine",
        "Shore Fish",
        "Cliff",
        "Petard",
        "Cavalry Archer",
        "Doppelganger",
        "Bird",
        "Gate",
        "Salvage Pile",
        "Resource Pile",
        "Relic",
        "Monk with Relic",
        "Hand Cannoneer",
        "Two Handed Swordsman",
        "Pikeman",
        "Scout",
        "Ore Mine",
        "Farm",
        "Spearman",
        "Packed Unit",
        "Tower",
        "Boarding Boat",
        "Unpacked Siege Unit",
        "Ballista",
        "Raider",
        "Cavalry Raider",
        "Livestock",
        "King",
        "Misc Building",
        "Controlled Animal"];

    const types = {
        "10": "Eye Candy",
        "15": "Tree (AoK)",
        "20": "Animated",
        "25": "Doppelganger",
        "30": "Moving",
        "40": "Actor",
        "50": "Superclass",
        "60": "Projectile",
        "70": "Combatant",
        "80": "Building",
        "90": "Tree (AoE)"
    };

    const toClass = (number) => {
        if (classes.hasOwnProperty('' + number)) {
            return `<div class="tags has-addons"><span class="tag">${classes[number]}</span><span class="tag is-info is-light">${number}</span></div>`;
        } else {
            return `<div class="tags has-addons"><span class="tag is-danger is-light">No/Invalid Class</span><span class="tag is-dark">${number}</span></div>`;
        }
    };
    const toType = (number) => {
        if (types.hasOwnProperty('' + number)) {
            return `<div class="tags has-addons"><span class="tag">${types[number]}</span><span class="tag is-info is-light">${number}</span></div>`;
        } else {
            return `<div class="tags has-addons"><span class="tag is-danger is-light">No/Invalid Type</span><span class="tag is-dark">${number}</span></div>`;
        }
    };


    const getid = (unit) => `${unit.base_id}${unit.name}${unit.localised_name}${unit.hit_points}${unit.line_of_sight}${unit.attack}${unit.melee_armor}${unit.pierce_armor}${unit.garrison_capacity}${unit.cost.wood}${unit.cost.food}${unit.cost.gold}${unit.cost.stone}${toType(unit.type)}${toClass(unit.class)}`.replace(/ /g, '_').toLowerCase();
    const gettechid = (id, unit) => `${id}${unit.name}${unit.localised_name}${unit.cost.wood}${unit.cost.food}${unit.cost.gold}${unit.cost.stone}`.replace(/ /g, '_').toLowerCase();
    const copyToClipboard = (str) => {
        if (navigator && navigator.clipboard && navigator.clipboard.writeText) {
            return navigator.clipboard.writeText(str);
        }
        return Promise.reject('The Clipboard API is not available.');
    };
    const init = (filename) => {
        fetch(filename)
            .then(response => response.json())
            .then(json => {
                const units_buildings_content = document.getElementById('units_buildings');
                units_buildings_content.innerHTML = '';
                for (let id in json.units_buildings) {
                    const unit = json.units_buildings[id];
                    const gcClass = unit.garrison_capacity > 0 ? ' active' : '';
                    const woodClass = unit.cost.wood > 0 ? ' active' : '';
                    const foodClass = unit.cost.food > 0 ? ' active' : '';
                    const goldClass = unit.cost.gold > 0 ? ' active' : '';
                    const stoneClass = unit.cost.stone > 0 ? ' active' : '';
                    const node = document.createElement('tr');
                    const rms_tag = unit.rms_const ? `<span class="tag is-light is-copyable">${unit.rms_const}</span>` : '';
                    node.id = getid(unit);
                    node.innerHTML = `<td>${unit.base_id}</td>
                    <td class="is-family-code">
                        <strong>${unit.name}</strong>
                        ${rms_tag}
                    </td>
                    <td>${unit.localised_name}</td>
                    <td>${unit.hit_points}</td>
                    <td>${unit.line_of_sight}</td>
                    <td>${unit.attack}</td>
                    <td>${unit.melee_armor}</td>
                    <td>${unit.pierce_armor}</td>
                    <td class="gc${gcClass}">${unit.garrison_capacity}</td>
                    <td class="wood${woodClass}">${unit.cost.wood}</td>
                    <td class="food${foodClass}">${unit.cost.food}</td>
                    <td class="gold${goldClass}">${unit.cost.gold}</td>
                    <td class="stone${stoneClass}">${unit.cost.stone}</td>
                    <td>${toType(unit.type)}</td>
                    <td>${toClass(unit.class)}</td>`;
                    units_buildings_content.appendChild(node);
                }
                document.querySelectorAll('.tag.is-copyable').forEach((tag => {
                    tag.onclick = (e) => {
                        const text = e.target.innerText;
                        copyToClipboard(text).then(() => {
                            e.target.innerText = 'copied!';
                            setTimeout(() => {
                                e.target.innerText = text;
                            }, 1000);
                        });
                    }
                }))
                const techs_content = document.getElementById('techs');
                techs_content.innerHTML = '';
                for (let id in json.techs) {
                    const unit = json.techs[id];
                    const woodClass = unit.cost.wood > 0 ? ' active' : '';
                    const foodClass = unit.cost.food > 0 ? ' active' : '';
                    const goldClass = unit.cost.gold > 0 ? ' active' : '';
                    const stoneClass = unit.cost.stone > 0 ? ' active' : '';
                    const node = document.createElement('tr');
                    node.id = gettechid(id, unit);
                    node.innerHTML = `<td>${id}</td>
                    <td class="is-family-code"><strong>${unit.name}</strong></td>
                    <td>${unit.localised_name}</td>
                    <td class="wood${woodClass}">${unit.cost.wood}</td>
                    <td class="food${foodClass}">${unit.cost.food}</td>
                    <td class="gold${goldClass}">${unit.cost.gold}</td>
                    <td class="stone${stoneClass}">${unit.cost.stone}</td>`;
                    techs_content.appendChild(node);
                }
                applyFilter();
            });
    };

    document.getElementById('filter').addEventListener('keyup', function (e) {
        if (e.key === "Escape") {
            document.getElementById('filter').value = '';
        }
        applyFilter();
    });

    document.getElementById('technologies').addEventListener('click', function (e) {
        document.getElementById('technologies').classList.add('is-active');
        document.getElementById('technologies-table').classList.remove('is-hidden');
        document.getElementById('units-buildings').classList.remove('is-active');
        document.getElementById('units-buildings-table').classList.add('is-hidden');
    });

    document.getElementById('units-buildings').addEventListener('click', function (e) {
        document.getElementById('technologies').classList.remove('is-active');
        document.getElementById('technologies-table').classList.add('is-hidden');
        document.getElementById('units-buildings').classList.add('is-active');
        document.getElementById('units-buildings-table').classList.remove('is-hidden');
    });

    document.getElementById('loadDE').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.remove('is-active');
        document.getElementById('loadWK').classList.remove('is-active');
        document.getElementById('loadDE').classList.add('is-active');
        document.getElementById('loadROR').classList.remove('is-active');
        init("data/units_buildings_techs.de.json");
    });

    document.getElementById('loadROR').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.remove('is-active');
        document.getElementById('loadWK').classList.remove('is-active');
        document.getElementById('loadDE').classList.remove('is-active');
        document.getElementById('loadROR').classList.add('is-active');
        init("data/units_buildings_techs.ror.json");
    });

    document.getElementById('loadHD').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.add('is-active');
        document.getElementById('loadWK').classList.remove('is-active');
        document.getElementById('loadDE').classList.remove('is-active');
        document.getElementById('loadROR').classList.remove('is-active');
        init("data/units_buildings_techs.hd.json");
    });

    document.getElementById('loadWK').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.remove('is-active');
        document.getElementById('loadWK').classList.add('is-active');
        document.getElementById('loadDE').classList.remove('is-active');
        document.getElementById('loadROR').classList.remove('is-active');
        init("data/units_buildings_techs.wk.json");
    });

    init("data/units_buildings_techs.de.json");
    document.getElementById('loadDE').classList.add('is-active');
</script>
<footer class="footer">
    <div class="container content has-text-grey-light is-size-7">
        <p>Made by <a href="https://aoe2.se" rel="author" class="has-text-grey">Siege Engineers</a>. You can contribute
            to this project on <a href="https://github.com/SiegeEngineers/halfon" rel="nofollow" class="has-text-grey">GitHub</a>.
        </p>
        <p>Age of Empires II &copy; Microsoft Corporation.<br/>
            <b>Halfon</b> was created under Microsoft's "<a href="https://www.xbox.com/en-us/developers/rules"
                                                            rel="nofollow" class="has-text-grey">Game Content Usage
                Rules</a>" using assets from Age of Empires II, and it is not endorsed by or affiliated with Microsoft.
        </p>
    </div>
</footer>
</body>
</html>
