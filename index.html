<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>[SE] HALFON</title>
    <link rel="stylesheet" href="css/bulma.min.css">
    <style>
        .table.units-buildings-table tbody tr td,
        .table.units-buildings-table thead tr th,
        .table.units-buildings-table tfoot tr th,
        .table.techs-table tbody tr td,
        .table.techs-table thead tr th,
        .table.techs-table tfoot tr th {
            text-align: right;
        }

        .table.units-buildings-table tbody tr td:nth-child(2),
        .table.units-buildings-table tbody tr td:nth-child(3),
        .table.units-buildings-table tbody tr td:nth-child(14),
        .table.units-buildings-table tbody tr td:nth-child(15),
        .table.units-buildings-table thead tr th:nth-child(2),
        .table.units-buildings-table thead tr th:nth-child(3),
        .table.units-buildings-table thead tr th:nth-child(14),
        .table.units-buildings-table thead tr th:nth-child(15),
        .table.units-buildings-table tfoot tr th:nth-child(2),
        .table.units-buildings-table tfoot tr th:nth-child(3),
        .table.units-buildings-table tfoot tr th:nth-child(14),
        .table.units-buildings-table tfoot tr th:nth-child(15),
        .table.techs-table tbody tr td:nth-child(2),
        .table.techs-table tbody tr td:nth-child(3),
        .table.techs-table thead tr th:nth-child(2),
        .table.techs-table thead tr th:nth-child(3),
        .table.techs-table tfoot tr th:nth-child(2),
        .table.techs-table tfoot tr th:nth-child(3) {
            text-align: left;
        }

        .wood {
            color: #830;
        }

        .food {
            color: #d00;
        }

        .gold {
            color: #da0;
        }

        .stone {
            color: #444;
        }

        #loadHD,
        #loadWK,
        #loadDE {
            cursor: pointer;
        }

        #loadHD.active,
        #loadWK.active,
        #loadDE.active {
            font-weight: bold;
        }
    </style>
</head>
<body>
<section class="hero is-warning is-bold">
    <div class="hero-body">
        <div class="container">
            <h1 class="title">
                <img src="SiegeEngineers.png" alt="SE"/> HALFON
            </h1>
            <h2 class="subtitle">
                Age of Empires II unit, building and tech reference ·
                <a href="#units-buildings">Units/Buildings</a> ·
                <a href="#technologies">Technologies</a> ·
                <small class="has-text-grey">Version:
                    <span id='loadDE'>AoEII DE Update 35584</span> |
                    <span id='loadHD'>AoEII HD Patch 5.8</span> |
                    <span id='loadWK'>AoEII WK Patch 5.8.1</span>
                </small>
            </h2>
            <p><input class="input" type="text" id="filter" placeholder="Filter…"></p>
        </div>
    </div>
</section>
<section class="section">
    <div class="container">
        <h3 id="units-buildings" class="title">Units / Buildings</h3>
        <table class="table is-narrow is-hoverable is-fullwidth units-buildings-table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Localised Name<abbr title="often inaccurate for non-conventional units">¹</abbr></th>
                <th><abbr title="Hitpoints">HP</abbr></th>
                <th><abbr title="Line of Sight">LOS</abbr></th>
                <th><abbr title="Attack">ATK</abbr></th>
                <th><abbr title="Melee Armor">MA</abbr></th>
                <th><abbr title="Pierce Armor">PA</abbr></th>
                <th><abbr title="Garrison Capacity">GC</abbr></th>
                <th><abbr title="Wood Cost">w</abbr></th>
                <th><abbr title="Food Cost">f</abbr></th>
                <th><abbr title="Gold Cost">g</abbr></th>
                <th><abbr title="Stone Cost">s</abbr></th>
                <th>Type</th>
                <th>Class</th>
            </tr>
            </thead>
            <tfoot>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Localised Name<abbr title="often inaccurate for non-conventional units">¹</abbr></th>
                <th><abbr title="Hitpoints">HP</abbr></th>
                <th><abbr title="Line of Sight">LOS</abbr></th>
                <th><abbr title="Attack">ATK</abbr></th>
                <th><abbr title="Melee Armor">MA</abbr></th>
                <th><abbr title="Pierce Armor">PA</abbr></th>
                <th><abbr title="Garrison Capacity">GC</abbr></th>
                <th><abbr title="Wood Cost">w</abbr></th>
                <th><abbr title="Food Cost">f</abbr></th>
                <th><abbr title="Gold Cost">g</abbr></th>
                <th><abbr title="Stone Cost">s</abbr></th>
                <th>Type</th>
                <th>Class</th>
            </tr>
            </tfoot>
            <tbody id="units_buildings" class="filterable">
            </tbody>
        </table>
        <h3 id="technologies" class="title">Technologies</h3>
        <table class="table is-narrow is-hoverable techs-table">
            <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Localised Name</th>
                <th><abbr title="Wood Cost">w</abbr></th>
                <th><abbr title="Food Cost">f</abbr></th>
                <th><abbr title="Gold Cost">g</abbr></th>
                <th><abbr title="Stone Cost">s</abbr></th>
            </tr>
            </thead>
            <tfoot>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Localised Name</th>
                <th><abbr title="Wood Cost">w</abbr></th>
                <th><abbr title="Food Cost">f</abbr></th>
                <th><abbr title="Gold Cost">g</abbr></th>
                <th><abbr title="Stone Cost">s</abbr></th>
            </tr>
            </tfoot>
            <tbody id="techs" class="filterable">
            </tbody>
        </table>
    </div>
</section>
<script>
    const applyFilter = () => {
        const input = document.getElementById('filter');
        const filter = input.value.replace(/ /g, '_').toLowerCase();
        const tables = document.getElementsByClassName('filterable');
        for (let table of tables) {
            const tr = table.getElementsByTagName('tr');

            for (let i = 0; i < tr.length; i++) {
                if (tr[i] !== undefined) {
                    if (tr[i].id.toLowerCase().indexOf(filter) > -1) {
                        tr[i].style.display = "";
                    } else {
                        tr[i].style.display = "none";
                    }
                }
            }
        }
    };

    const classes = ["Archer",
        "Artifact",
        "Trade Boat",
        "Building",
        "Civilian",
        "Ocean Fish",
        "Infantry",
        "Berry Bush",
        "Stone Mine",
        "Prey Animal",
        "Predator Animal",
        "Miscellaneous",
        "Cavalry",
        "Siege Weapon",
        "Terrain",
        "Tree",
        "Tree Stump",
        "Healer",
        "Monk",
        "Trade Cart",
        "Transport Boat",
        "Fishing Boat",
        "Warship",
        "Conquistador",
        "War Elephant",
        "Hero",
        "Elephant Archer",
        "Wall",
        "Phalanx",
        "Domestic Animal",
        "Flag",
        "Deep Sea Fish",
        "Gold Mine",
        "Shore Fish",
        "Cliff",
        "Petard",
        "Cavalry Archer",
        "Doppelganger",
        "Bird",
        "Gate",
        "Salvage Pile",
        "Resource Pile",
        "Relic",
        "Monk with Relic",
        "Hand Cannoneer",
        "Two Handed Swordsman",
        "Pikeman",
        "Scout",
        "Ore Mine",
        "Farm",
        "Spearman",
        "Packed Unit",
        "Tower",
        "Boarding Boat",
        "Unpacked Siege Unit",
        "Ballista",
        "Raider",
        "Cavalry Raider",
        "Livestock",
        "King",
        "Misc Building",
        "Controlled Animal"];

    const types = {
        "10": "Eye Candy",
        "15": "Tree (AoK)",
        "20": "Animated",
        "25": "Doppelganger",
        "30": "Moving",
        "40": "Actor",
        "50": "Superclass",
        "60": "Projectile",
        "70": "Combatant",
        "80": "Building",
        "90": "Tree (AoE)"
    };

    const toClass = (number) => {
        if (classes.hasOwnProperty('' + number)) {
            return `<abbr title="${number}">${classes[number]}</abbr>`;
        } else {
            return `<abbr title="${number}">No/Invalid Class</abbr>`;
        }
    };
    const toType = (number) => {
        if (types.hasOwnProperty('' + number)) {
            return `<abbr title="${number}">${types[number]}</abbr>`;
        } else {
            return `<abbr title="${number}">No/Invalid Type</abbr>`;
        }
    };


    const getid = (unit) => `${unit.base_id}${unit.name}${unit.localised_name}${unit.hit_points}${unit.line_of_sight}${unit.attack}${unit.melee_armor}${unit.pierce_armor}${unit.garrison_capacity}${unit.cost.wood}${unit.cost.food}${unit.cost.gold}${unit.cost.stone}${toType(unit.type)}${toClass(unit.class)}`.replace(/ /g, '_').toLowerCase();
    const gettechid = (id, unit) => `${id}${unit.name}${unit.localised_name}${unit.cost.wood}${unit.cost.food}${unit.cost.gold}${unit.cost.stone}`.replace(/ /g, '_').toLowerCase();
    const init = (filename) => {
        fetch(filename)
            .then(response => response.json())
            .then(json => {
                const units_buildings_content = document.getElementById('units_buildings');
                units_buildings_content.innerHTML = '';
                for (let id in json.units_buildings) {
                    const unit = json.units_buildings[id];
                    const node = document.createElement('tr');
                    node.id = getid(unit);
                    node.innerHTML = `<td>${unit.base_id}</td>
                    <td>${unit.name}</td>
                    <td style='font-style:italic;'>${unit.localised_name}</td>
                    <td>${unit.hit_points}</td>
                    <td>${unit.line_of_sight}</td>
                    <td>${unit.attack}</td>
                    <td>${unit.melee_armor}</td>
                    <td>${unit.pierce_armor}</td>
                    <td>${unit.garrison_capacity}</td>
                    <td class="wood">${unit.cost.wood}</td>
                    <td class="food">${unit.cost.food}</td>
                    <td class="gold">${unit.cost.gold}</td>
                    <td class="stone">${unit.cost.stone}</td>
                    <td>${toType(unit.type)}</td>
                    <td>${toClass(unit.class)}</td>`;
                    units_buildings_content.appendChild(node);
                }
                const techs_content = document.getElementById('techs');
                techs_content.innerHTML = '';
                for (let id in json.techs) {
                    const unit = json.techs[id];
                    const node = document.createElement('tr');
                    node.id = gettechid(id, unit);
                    node.innerHTML = `<td>${id}</td>
                    <td>${unit.name}</td>
                    <td style='font-style:italic;'>${unit.localised_name}</td>
                    <td>${unit.cost.wood}</td>
                    <td>${unit.cost.food}</td>
                    <td>${unit.cost.gold}</td>
                    <td>${unit.cost.stone}</td>`;
                    techs_content.appendChild(node);
                }
                applyFilter();
            });
    };

    document.getElementById('filter').addEventListener('keyup', function (e) {
        if (e.key === "Escape") {
            document.getElementById('filter').value = '';
        }
        applyFilter();
    });

    document.getElementById('loadDE').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.remove('active');
        document.getElementById('loadWK').classList.remove('active');
        document.getElementById('loadDE').classList.add('active');
        init("units_buildings_techs.de.json");
    });

    document.getElementById('loadHD').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.add('active');
        document.getElementById('loadWK').classList.remove('active');
        document.getElementById('loadDE').classList.remove('active');
        init("units_buildings_techs.hd.json");
    });

    document.getElementById('loadWK').addEventListener('click', function (e) {
        document.getElementById('loadHD').classList.remove('active');
        document.getElementById('loadWK').classList.add('active');
        document.getElementById('loadDE').classList.remove('active');
        init("units_buildings_techs.wk.json");
    });

    init("units_buildings_techs.de.json");
    document.getElementById('loadDE').classList.add('active');
</script>
</body>
</html>
